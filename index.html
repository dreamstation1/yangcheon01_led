<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë²„ìŠ¤ ì•ˆë‚´ ì „ê´‘íŒ (í†µí•©)</title>
  <style>
    @font-face {
      font-family: 'HYê²¬ê³ ë”•';
      src: url('HYê²¬ê³ ë”•.ttf') format('truetype');
      font-display: swap;
      font-weight: normal;
      font-style: normal;
    }
    
    /* í°íŠ¸ ë¡œë”© ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ í°íŠ¸ */
    .font-fallback {
      font-family: 'HYê²¬ê³ ë”•', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Arial', sans-serif;
    }
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 0;
      background-color: white;
      height: 100vh;
      gap: 20px;
    }
    .square {
      position: relative;
      width: 1280px;
      height: 320px;
      background-color: rgb(33, 33, 33);
      border: 20px solid rgb(20, 20, 20);
      overflow: hidden;
    }
    .grid-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-columns: repeat(128, 1fr);
      grid-template-rows: repeat(32, 1fr);
      z-index: 2;
      pointer-events: none;
    }
    .cell { border: 0.5px solid rgb(60, 60, 60); aspect-ratio: 1 / 1; }
    .title {
      position: absolute;
      top: 5px;
      left: 50%;
      transform: translateX(-50%);
      color: yellow;
      font-size: 120px;
      font-family: 'HYê²¬ê³ ë”•', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Arial', sans-serif;
      z-index: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .title span { margin: 0 100px; }
    .scroll-text {
      position: absolute;
      bottom: 20px;
      white-space: nowrap;
      font-size: 120px;
      font-family: 'HYê²¬ê³ ë”•', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Arial', sans-serif;
      z-index: 1;
      display: none;
      transform: translateX(0);
    }
    .yellow { color: yellow; }
    .orange { color: orange; }
    .red { color: red; }
    .green { color: lime; }
    .third-top, .third-bottom, .fourth-top, .fourth-bottom {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 100px;
      font-family: 'HYê²¬ê³ ë”•', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Arial', sans-serif;
      z-index: 1;
      display: none;
      white-space: nowrap;
    }
    .third-top { top: 20px; }
    .third-bottom { bottom: 20px; }
    .fourth-top { top: 20px; }
    .fourth-bottom { bottom: 20px; }
    .location-display {
      position: absolute;
      top: 5px;
      left: 5px;
      color: yellow;
      font-size: 20px;
      font-family: monospace;
      z-index: 3;
      background: rgba(0,0,0,0.5);
      padding: 3px 8px;
      border-radius: 8px;
    }
    
    /* ë‘ ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ìŠ¤íƒ€ì¼ */
    .top-label {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 110px;
      font-family: 'HYê²¬ê³ ë”•', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Arial', sans-serif;
      color: lime;
      z-index: 1;
      white-space: nowrap;
      display: none;
    }
    .scroll-lcd {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      white-space: nowrap;
      font-size: 110px;
      font-family: 'HYê²¬ê³ ë”•', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Arial', sans-serif;
      color: yellow;
      z-index: 1;
      left: 0;
      display: none;
    }
    .center-line {
      position: absolute;
      left: 0;
      width: 100%;
      height: 4px;
      background: red;
      top: 50%;
      transform: translateY(-50%);
      z-index: 3;
      display: none;
    }
    
    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .control-buttons {
      display: flex;
      gap: 10px;
    }
    .control-btn {
      padding: 10px 20px;
      font-size: 16px;
      font-family: 'HYê²¬ê³ ë”•', sans-serif;
      background-color: #333;
      color: white;
      border: 2px solid #555;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .control-btn:hover {
      background-color: #555;
      border-color: #777;
    }
    .control-btn.active {
      background-color: #007bff;
      border-color: #0056b3;
    }
  </style>
</head>
<body>
  <div class="square">
    <!-- ì²« ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ìš”ì†Œë“¤ -->
    <div class="title" id="title"><span>ì•Œ</span><span>ë¦¼</span></div>

    <!-- ìŠ¤í¬ë¡¤ ë¬¸êµ¬ 1~8 -->
    <div class="scroll-text" id="scroll-text-1">
      <span class="yellow">ë²„ìŠ¤ê°€ ì£¼í–‰ì¤‘ì—ëŠ” ìë¦¬ì—ì„œ </span><span class="red">ì´ë™ì„ ì‚¼ê°€í•˜ì‹œê³ </span>
      <span class="green">ë‚´ë¦¬ì‹¤ë¶„ì€ ì•‰ì€ìë¦¬ì—ì„œ </span><span class="red">ë²¨ì„</span>
      <span class="yellow">ë¯¸ë¦¬ ëˆŒëŸ¬ì£¼ì‹œê³  </span><span class="red">ë²„ìŠ¤ê°€ ì™„ì „íˆ ì •ì°¨í•œí›„</span>
      <span class="green">í•˜ì°¨ í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</span>
    </div>
    <div class="scroll-text" id="scroll-text-2">
      <span class="red">*ë¬´ì œí•œ ì„œìš¸ ëŒ€ì¤‘êµí†µ ì´ìš©*</span><span class="green">ëª¨ë°”ì¼í‹°ë¨¸ë‹ˆ </span><span class="yellow">ê¸°í›„ë™í–‰ì¹´ë“œ</span>
    </div>
    <div class="scroll-text" id="scroll-text-3">
      <span class="yellow">ì°¨ë‚´ </span><span class="red">í†µí™”ë¥¼ </span><span class="yellow">í•˜ì‹¤ë•ŒëŠ” </span><span class="red">ê·“ì†ë§ë¡œ</span>
      <span class="green"> í•´ì£¼ì‹œê³  </span><span class="yellow">ì˜† ì‚¬ëŒì—ê²Œ </span><span class="red">ë°©í•´ê°€ </span><span class="green">ë˜ì§€ ì•Šë„ë¡ </span><span class="yellow">í•´ì£¼ì‹œê¸° </span><span class="red">ë°”ëë‹ˆë‹¤.</span>
    </div>
    <div class="scroll-text" id="scroll-text-4">
      <span class="yellow">ì´ ì°¨ëŸ‰ì€ </span><span class="green">ê³µê¸°ì²­ì •ê¸°</span><span class="yellow">ë¥¼ ê°€ë™í•˜ì—¬ </span><span class="red">ë°”ì´ëŸ¬ìŠ¤,ì„¸ê·  </span><span class="yellow">ì˜ 2ì°¨ ê°ì—¼ì„ </span><span class="green">ì˜ˆë°© </span><span class="yellow">í•˜ê³  ìˆìŠµë‹ˆë‹¤.</span>
    </div>
    <div class="scroll-text" id="scroll-text-5">
      <span class="orange">êµí†µì¹´ë“œ </span><span class="red">ì”ì•¡ì´ ê¶ê¸ˆí• ë•? </span><span class="orange">ëª¨ë°”ì¼í‹°ë¨¸ë‹ˆ ì•±! </span><span class="green">ë°”ë¡œ ì¶©ì „ë„ ê°€ëŠ¥í•´ìš”~</span>
    </div>
    <div class="scroll-text" id="scroll-text-6">
      <span class="orange">ê¹¨ë—í•˜ê³ ,</span><span class="red"> ì•ˆì „í•˜ê³ ,</span><span class="green"> ì¹œì ˆí•œ </span><span class="orange"> ì„œë¹„ìŠ¤ë¡œ ê³ ê° ì—¬ëŸ¬ë¶„ê»˜ </span><span class="green"> ë”ìš± ê°€ê¹Œì´ ë‹¤ê°€ê°€ê² ìŠµë‹ˆë‹¤ </span><span class="orange"> . </span>
    </div>
    <div class="scroll-text" id="scroll-text-7">
      <span class="red">ì•ˆì „ì„ ìœ„í•´</span><span class="orange"> í•˜ì°¨ì‹œ ì¢Œìš° í™•ì¸! <</span><span class="green">ê¸¸ì„ ê±´ë„ë•ŒëŠ”</span><span class="red"> íš¡ë‹¨ë³´ë„ ì´ìš©</span><span class="orange">â–¶</span>
    </div>
    <div class="scroll-text" id="scroll-text-8">
      <span class="orange">ì‚¬ëŒì´ ë³´ì´ë©´ </span><span class="red"> ì¼ë‹¨,ë©ˆì¶¤!  "</span><span class="orange">í•œìˆœê°„ì˜ ë¬´ë‹¨íš¡ë‹¨,</span><span class="red">êµí†µì‚¬ê³ ë„ </span><span class="green">í•œìˆœê°„ì…ë‹ˆë‹¤.</span>
    </div>

    <div class="third-top" id="third-top">
      <span class="yellow">ëª©ë™ìš´ìˆ˜ </span><span class="green">ì–‘ì²œ</span><span class="red">01</span>
    </div>
    <div class="third-bottom" id="third-bottom">
      <span class="green">ì²«ì°¨ </span><span class="red">05:30 </span><span class="green">ë§‰ì°¨ </span><span class="red">23:40</span>
    </div>

    <div class="fourth-top" id="fourth-top"></div>
    <div class="fourth-bottom" id="fourth-bottom"></div>

    <!-- ë‘ ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ìš”ì†Œë“¤ -->
    <div class="top-label" id="topLabel">ì´ë²ˆ ì •ë¥˜ì†Œ</div>
    <div class="scroll-lcd" id="scrollLcd">ì–‘í‰í•œì‹ ì•„íŒŒíŠ¸, 9í˜¸ì„ ì„ ìœ ë„ì—­</div>
    <div class="center-line" id="centerLine"></div>

    <div class="grid-overlay" id="grid-overlay"></div>
    <div class="location-display" id="locationDisplay">ìœ„ì¹˜: ë¶ˆëª…</div>
  </div>

  <!-- ì œì–´ ë²„íŠ¼ë“¤ -->
  <div class="control-buttons">
    <button class="control-btn active" id="display1Btn">ì•ˆë‚´ ë¬¸êµ¬</button>
    <button class="control-btn" id="display2Btn">ì •ë¥˜ì†Œ ì•ˆë‚´</button>
  </div>

  <audio id="announcement" src="sunyudo.mp3"></audio>
  <audio id="dangsanAudio" src="dangsan.mp3"></audio>
  <audio id="mok6Audio" src="mok6.mp3"></audio>

  <script>
    // ì „ì—­ ë³€ìˆ˜ë“¤
    let currentDisplay = 1; // 1: ì•ˆë‚´ ë¬¸êµ¬, 2: ì •ë¥˜ì†Œ ì•ˆë‚´
    let display1Interval;
    let display2Timeout;
    
    // ì²« ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ê´€ë ¨ ë³€ìˆ˜ë“¤
    const scrollTexts = [
      { id: 'scroll-text-1', duration: 24370 },
      { id: 'scroll-text-2', duration: 10000 },
      { id: 'scroll-text-3', duration: 17000 },
      { id: 'scroll-text-4', duration: 15000 },
      { id: 'scroll-text-5', duration: 13000 },
      { id: 'scroll-text-6', duration: 15000 },
      { id: 'scroll-text-7', duration: 11000 },
      { id: 'scroll-text-8', duration: 13000 }
    ];

    const title = document.getElementById('title');
    const thirdTop = document.getElementById('third-top');
    const thirdBottom = document.getElementById('third-bottom');
    const fourthTop = document.getElementById('fourth-top');
    const fourthBottom = document.getElementById('fourth-bottom');
    const locationDisplay = document.getElementById('locationDisplay');
    const containerWidth = 1280;
    const speed = 330;
    let lastIndex = 0;
    let currentSpeed = 31.4;
    let inTarget = false;

    // ë‘ ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ê´€ë ¨ ë³€ìˆ˜ë“¤
    const topLabel = document.getElementById('topLabel');
    const scrollLcd = document.getElementById('scrollLcd');
    const centerLine = document.getElementById('centerLine');
    const audio = document.getElementById('announcement'); // nullì¼ ìˆ˜ ìˆìŒ

    // ë²„íŠ¼ ìš”ì†Œë“¤
    const display1Btn = document.getElementById('display1Btn');
    const display2Btn = document.getElementById('display2Btn');

    // ì²« ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ í•¨ìˆ˜ë“¤
    function randomNext() {
      if (inTarget || currentDisplay !== 1) return;
      let next;
      do { next = Math.floor(Math.random() * 8) + 1; } while (next === lastIndex);
      lastIndex = next;
      showMessage(next);
    }

    function showMessage(index) {
      if (currentDisplay !== 1) return;
      
      scrollTexts.forEach(item => document.getElementById(item.id).style.display = 'none');
      thirdTop.style.display = 'none';
      thirdBottom.style.display = 'none';
      fourthTop.style.display = 'none';
      fourthBottom.style.display = 'none';
      title.style.display = 'flex';

      if (index === 6) {
        title.style.display = 'none';
        thirdTop.style.display = 'block';
        thirdBottom.style.display = 'block';
        display1Interval = setTimeout(randomNext, 5000);
        return;
      }

      if (index === 7) {
        title.style.display = 'none';
        thirdTop.style.display = 'block';
        thirdBottom.style.display = 'block';
        display1Interval = setTimeout(randomNext, 5000);
        return;
      }

      const elem = document.getElementById(`scroll-text-${index}`);
      elem.style.display = 'block';
      const width = elem.scrollWidth;
      const totalDistance = width + containerWidth;
      const duration = totalDistance / speed;
      elem.style.transform = `translateX(0)`;
      elem.style.transition = 'none';

      setTimeout(() => {
        elem.style.transition = `transform ${duration}s linear`;
        elem.style.transform = `translateX(-${totalDistance}px)`;
      }, 500);

      display1Interval = setTimeout(randomNext, scrollTexts[index - 1].duration);
    }

    // ë‘ ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ í•¨ìˆ˜ë“¤
    function startDisplay2() {
      console.log('startDisplay2 í•¨ìˆ˜ ì‹œì‘');
      
      // ëª¨ë“  ì²« ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ìš”ì†Œ ìˆ¨ê¸°ê¸°
      title.style.display = 'none';
      scrollTexts.forEach(item => document.getElementById(item.id).style.display = 'none');
      thirdTop.style.display = 'none';
      thirdBottom.style.display = 'none';
      fourthTop.style.display = 'none';
      fourthBottom.style.display = 'none';
      console.log('ì²« ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ìš”ì†Œë“¤ ìˆ¨ê¹€ ì™„ë£Œ');

      // ë‘ ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ìš”ì†Œë“¤ í‘œì‹œ
      topLabel.textContent = 'ì´ë²ˆ ì •ë¥˜ì†Œ';
      topLabel.style.display = 'block';
      scrollLcd.textContent = 'ì–‘í‰í•œì‹ ì•„íŒŒíŠ¸, 9í˜¸ì„ ì„ ìœ ë„ì—­';
      scrollLcd.style.display = 'block';
      centerLine.style.display = 'block';
      console.log('ë‘ ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ìš”ì†Œë“¤ í‘œì‹œ ì™„ë£Œ: ì´ë²ˆ ì •ë¥˜ì†Œ - ì–‘í‰í•œì‹ ì•„íŒŒíŠ¸, 9í˜¸ì„ ì„ ìœ ë„ì—­');

      const textWidth = scrollLcd.scrollWidth;
      const totalDistance = textWidth + containerWidth;
      const duration = totalDistance / speed;

      scrollLcd.style.transform = 'translateX(0)';
      scrollLcd.style.transition = 'none';
      
      // ì˜¤ë””ì˜¤ ì¬ìƒ (ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í›„ì—ë§Œ)
      if (userInteracted) {
        audio.volume = 1.0;
        audio.play().catch(error => {
          console.log('ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨:', error);
          // ì˜¤ë””ì˜¤ ì¬ìƒì´ ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
        });
      } else {
        console.log('ì‚¬ìš©ì ìƒí˜¸ì‘ìš©ì´ ì—†ì–´ì„œ ì˜¤ë””ì˜¤ ì¬ìƒ ê±´ë„ˆëœ€');
      }

      setTimeout(() => {
        scrollLcd.style.transition = `transform ${duration}s linear`;
        scrollLcd.style.transform = `translateX(-${totalDistance}px)`;
      }, 500);

      // 5.38ì´ˆ í›„ â†’ ì²« í™”ë©´ ìˆ¨ê¸°ê³  â†’ ë‹¤ìŒ ì •ë¥˜ì†Œ í‘œì‹œ
      display2Timeout = setTimeout(() => {
        scrollLcd.style.display = 'none';
        topLabel.style.display = 'none';
        centerLine.style.display = 'none';

        setTimeout(() => {
          topLabel.textContent = 'ë‹¤ìŒ ì •ë¥˜ì†Œ';
          topLabel.style.color = 'lime';
          topLabel.style.display = 'block';

          scrollLcd.textContent = 'ì§€í•˜ì²  2,9í˜¸ì„  ë‹¹ì‚°ì—­';
          scrollLcd.style.color = 'yellow';
          scrollLcd.style.left = '50%';
          scrollLcd.style.top = '50%';
          scrollLcd.style.transform = 'translateX(-50%) translateY(0%)';
          scrollLcd.style.transition = 'none';
          scrollLcd.style.display = 'block';

          centerLine.style.display = 'block';
        }, 500);
      }, 5380);

      // 12ì´ˆ í›„ â†’ ì˜ì–´ ì•ˆë‚´ë¡œ êµì²´
      setTimeout(() => {
        topLabel.textContent = 'THIS STOP IS';
        topLabel.style.color = 'lime';
        topLabel.style.display = 'block';

        scrollLcd.textContent = 'Yangpyeong Hanshin Apt. Line 9 Seonyudo Station';
        scrollLcd.style.color = 'yellow';
        scrollLcd.style.left = '0';
        scrollLcd.style.top = '50%';
        scrollLcd.style.transform = 'translateY(0%)';
        scrollLcd.style.transition = 'none';
        scrollLcd.style.display = 'block';

        const engTextWidth = scrollLcd.scrollWidth;
        const engTotalDistance = engTextWidth + containerWidth;
        const engDuration = engTotalDistance / speed;

        setTimeout(() => {
          scrollLcd.style.transition = `transform ${engDuration}s linear`;
          scrollLcd.style.transform = `translate(-${engTotalDistance}px, 0%)`;
        }, 500);
      }, 12000);

      // 21.85ì´ˆ í›„ â†’ ëª¨ë‘ ìˆ¨ê¹€ (0.5ì´ˆ)
      setTimeout(() => {
        topLabel.style.display = 'none';
        scrollLcd.style.display = 'none';
        centerLine.style.display = 'none';

        setTimeout(() => {
          topLabel.textContent = 'NEXT STOP IS';
          topLabel.style.color = 'lime';
          topLabel.style.display = 'block';

          scrollLcd.textContent = 'Line 2 Dangsan Station';
          scrollLcd.style.color = 'yellow';
          scrollLcd.style.left = '0';
          scrollLcd.style.top = '50%';
          scrollLcd.style.transform = 'translateY(0%)';
          scrollLcd.style.transition = 'none';
          scrollLcd.style.display = 'block';

          centerLine.style.display = 'block';

          const eng2Width = scrollLcd.scrollWidth;
          const eng2TotalDistance = eng2Width + containerWidth;
          const eng2Duration = eng2TotalDistance / speed;

          setTimeout(() => {
            scrollLcd.style.transition = `transform ${eng2Duration}s linear`;
            scrollLcd.style.transform = `translate(-${eng2TotalDistance}px, 0%)`;
            
            // ì •ë¥˜ì†Œ ì•ˆë‚´ ì™„ë£Œ í›„ ì•ˆë‚´ ë¬¸êµ¬ë¡œ ìë™ ì „í™˜
            setTimeout(() => {
              switchToDisplay1();
            }, (eng2Duration + 0.5) * 1000);
          }, 500);
        }, 500);
      }, 21850);
    }

    // ë””ìŠ¤í”Œë ˆì´ ì „í™˜ í•¨ìˆ˜ë“¤
    function switchToDisplay1() {
      currentDisplay = 1;
      
      // ë‘ ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ìš”ì†Œë“¤ ìˆ¨ê¸°ê¸°
      topLabel.style.display = 'none';
      scrollLcd.style.display = 'none';
      centerLine.style.display = 'none';
      
      // ì²« ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ì‹œì‘
      randomNext();
      
      // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
      display1Btn.classList.add('active');
      display2Btn.classList.remove('active');
    }

    // ì •ë¥˜ì†Œë³„ ì•ˆë‚´ í•¨ìˆ˜
    function startStationAnnouncement(station) {
      console.log(`${station.name} ì •ë¥˜ì†Œ ì•ˆë‚´ ì‹œì‘`);
      currentDisplay = 2;
      
      // ì²« ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ì •ì§€
      if (display1Interval) {
        clearTimeout(display1Interval);
        console.log('ì²« ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ íƒ€ì´ë¨¸ ì •ì§€ë¨');
      }
      
      // ëª¨ë“  ì²« ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ìš”ì†Œ ìˆ¨ê¸°ê¸°
      title.style.display = 'none';
      scrollTexts.forEach(item => document.getElementById(item.id).style.display = 'none');
      thirdTop.style.display = 'none';
      thirdBottom.style.display = 'none';
      fourthTop.style.display = 'none';
      fourthBottom.style.display = 'none';
      
      // ë‘ ë²ˆì§¸ ë””ìŠ¤í”Œë ˆì´ ìš”ì†Œë“¤ í‘œì‹œ
      topLabel.textContent = 'ì´ë²ˆ ì •ë¥˜ì†Œ';
      topLabel.style.display = 'block';
      scrollLcd.textContent = station.displayText;
      scrollLcd.style.display = 'block';
      centerLine.style.display = 'block';
      
      const textWidth = scrollLcd.scrollWidth;
      const totalDistance = textWidth + containerWidth;
      const duration = totalDistance / speed;

      scrollLcd.style.transform = 'translateX(0)';
      scrollLcd.style.transition = 'none';
      
      // í•´ë‹¹ ì •ë¥˜ì†Œ ì˜¤ë””ì˜¤ ì¬ìƒ
      const stationAudio = document.getElementById(station.audio);
      if (userInteracted && stationAudio) {
        stationAudio.volume = 1.0;
        stationAudio.play().catch(error => {
          console.log(`${station.name} ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨:`, error);
        });
      } else {
        console.log('ì‚¬ìš©ì ìƒí˜¸ì‘ìš©ì´ ì—†ì–´ì„œ ì˜¤ë””ì˜¤ ì¬ìƒ ê±´ë„ˆëœ€');
      }

      setTimeout(() => {
        scrollLcd.style.transition = `transform ${duration}s linear`;
        scrollLcd.style.transform = `translateX(-${totalDistance}px)`;
      }, 500);

      // 5.38ì´ˆ í›„ â†’ ì²« í™”ë©´ ìˆ¨ê¸°ê³  â†’ ë‹¤ìŒ ì •ë¥˜ì†Œ í‘œì‹œ
      display2Timeout = setTimeout(() => {
        scrollLcd.style.display = 'none';
        topLabel.style.display = 'none';
        centerLine.style.display = 'none';

        setTimeout(() => {
          topLabel.textContent = 'ë‹¤ìŒ ì •ë¥˜ì†Œ';
          topLabel.style.color = 'lime';
          topLabel.style.display = 'block';

          // ë‹¤ìŒ ì •ë¥˜ì†Œ í…ìŠ¤íŠ¸ ì„¤ì •
          let nextStationText = '';
          if (station.name === 'ëª©ë™6ë‹¨ì§€ìƒê°€') {
            nextStationText = 'ì–‘í‰í•œì‹ ì•„íŒŒíŠ¸, 9í˜¸ì„ ì„ ìœ ë„ì—­';
          } else if (station.name === 'ì„ ìœ ë„ì—­') {
            nextStationText = 'ì§€í•˜ì²  2,9í˜¸ì„  ë‹¹ì‚°ì—­';
          } else if (station.name === 'ë‹¹ì‚°ì—­') {
            nextStationText = 'ì–‘í‰í•œì‹ ì•„íŒŒíŠ¸, 9í˜¸ì„ ì„ ìœ ë„ì—­';
          }
          
          scrollLcd.textContent = nextStationText;
          scrollLcd.style.color = 'yellow';
          scrollLcd.style.left = '0';
          scrollLcd.style.top = '50%';
          scrollLcd.style.transform = 'translateY(0%)';
          scrollLcd.style.transition = 'none';
          scrollLcd.style.display = 'block';

          centerLine.style.display = 'block';

          // ë‹¤ìŒ ì •ë¥˜ì†Œ í…ìŠ¤íŠ¸ë„ ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
          const nextTextWidth = scrollLcd.scrollWidth;
          const nextTotalDistance = nextTextWidth + containerWidth;
          const nextDuration = nextTotalDistance / speed;

          setTimeout(() => {
            scrollLcd.style.transition = `transform ${nextDuration}s linear`;
            scrollLcd.style.transform = `translateX(-${nextTotalDistance}px)`;
          }, 500);
        }, 500);
      }, 5380);

      // 12ì´ˆ í›„ â†’ ì˜ì–´ ì•ˆë‚´ë¡œ êµì²´
      setTimeout(() => {
        topLabel.textContent = 'THIS STOP IS';
        topLabel.style.color = 'lime';
        topLabel.style.display = 'block';

        // ì˜ì–´ í…ìŠ¤íŠ¸ ì„¤ì •
        let engText = '';
        if (station.name === 'ëª©ë™6ë‹¨ì§€ìƒê°€') {
          engText = 'Mokdong 6 Danji Store, Ewha Womans Univ. Mok-dong Hospital';
        } else if (station.name === 'ì„ ìœ ë„ì—­') {
          engText = 'Yangpyeong Hanshin Apt. Line 9 Seonyudo Station';
        } else if (station.name === 'ë‹¹ì‚°ì—­') {
          engText = 'Line 2,9 Dangsan Station';
        }

        scrollLcd.textContent = engText;
        scrollLcd.style.color = 'yellow';
        scrollLcd.style.left = '0';
        scrollLcd.style.top = '50%';
        scrollLcd.style.transform = 'translateY(0%)';
        scrollLcd.style.transition = 'none';
        scrollLcd.style.display = 'block';

        const engTextWidth = scrollLcd.scrollWidth;
        const engTotalDistance = engTextWidth + containerWidth;
        const engDuration = engTotalDistance / speed;

        setTimeout(() => {
          scrollLcd.style.transition = `transform ${engDuration}s linear`;
          scrollLcd.style.transform = `translate(-${engTotalDistance}px, 0%)`;
        }, 500);
      }, 12000);

      // 21.85ì´ˆ í›„ â†’ ëª¨ë‘ ìˆ¨ê¹€ (0.5ì´ˆ)
      setTimeout(() => {
        topLabel.style.display = 'none';
        scrollLcd.style.display = 'none';
        centerLine.style.display = 'none';

        setTimeout(() => {
          topLabel.textContent = 'NEXT STOP IS';
          topLabel.style.color = 'lime';
          topLabel.style.display = 'block';

          // ì˜ì–´ ë‹¤ìŒ ì •ë¥˜ì†Œ í…ìŠ¤íŠ¸ ì„¤ì •
          let engNextText = '';
          if (station.name === 'ëª©ë™6ë‹¨ì§€ìƒê°€') {
            engNextText = 'Yangpyeong Hanshin Apt. Line 9 Seonyudo Station';
          } else if (station.name === 'ì„ ìœ ë„ì—­') {
            engNextText = 'Line 2,9 Dangsan Station';
          } else if (station.name === 'ë‹¹ì‚°ì—­') {
            engNextText = 'Yangpyeong Hanshin Apt. Line 9 Seonyudo Station';
          }

          scrollLcd.textContent = engNextText;
          scrollLcd.style.color = 'yellow';
          scrollLcd.style.left = '0';
          scrollLcd.style.top = '50%';
          scrollLcd.style.transform = 'translateY(0%)';
          scrollLcd.style.transition = 'none';
          scrollLcd.style.display = 'block';

          centerLine.style.display = 'block';

          const eng2Width = scrollLcd.scrollWidth;
          const eng2TotalDistance = eng2Width + containerWidth;
          const eng2Duration = eng2TotalDistance / speed;

          setTimeout(() => {
            scrollLcd.style.transition = `transform ${eng2Duration}s linear`;
            scrollLcd.style.transform = `translate(-${eng2TotalDistance}px, 0%)`;
            
            // ì •ë¥˜ì†Œ ì•ˆë‚´ ì™„ë£Œ í›„ ì•ˆë‚´ ë¬¸êµ¬ë¡œ ìë™ ì „í™˜
            setTimeout(() => {
              switchToDisplay1();
            }, (eng2Duration + 0.5) * 1000);
          }, 500);
        }, 500);
      }, 21850);
      
      // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
      display2Btn.classList.add('active');
      display1Btn.classList.remove('active');
    }

    function switchToDisplay2() {
      console.log('switchToDisplay2 í•¨ìˆ˜ í˜¸ì¶œë¨');
      // ê¸°ë³¸ì ìœ¼ë¡œ ëª©ë™6ë‹¨ì§€ìƒê°€ë¡œ ì‹œì‘
      startStationAnnouncement(stations[0]);
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    display1Btn.addEventListener('click', switchToDisplay1);
    display2Btn.addEventListener('click', () => {
      // ì •ë¥˜ì†Œ ì•ˆë‚´ ë²„íŠ¼ í´ë¦­ ì‹œ ì‚¬ìš©ì ìƒí˜¸ì‘ìš©ìœ¼ë¡œ ê°„ì£¼
      if (!userInteracted) {
        userInteracted = true;
        console.log('ì •ë¥˜ì†Œ ì•ˆë‚´ ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ê°ì§€');
        if (audio) {
          audio.load();
        }
      }
      switchToDisplay2();
    });
    
    // ì˜¤ë””ì˜¤ ìë™ ì¬ìƒì„ ìœ„í•œ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ê°ì§€
    let userInteracted = false;
    
    // í˜ì´ì§€ í´ë¦­ ì‹œ ì˜¤ë””ì˜¤ ì¬ìƒ í—ˆìš©
    document.addEventListener('click', function() {
      if (!userInteracted) {
        userInteracted = true;
        console.log('ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ê°ì§€: ì˜¤ë””ì˜¤ ì¬ìƒ ê°€ëŠ¥');
        // ì˜¤ë””ì˜¤ë¥¼ ë¯¸ë¦¬ ë¡œë“œ
        if (audio) {
          audio.load();
        }
      }
    }, { once: true });

    // ëª©í‘œ ìœ„ì¹˜ë“¤ (ì •ë¥˜ì†Œ ìœ„ì¹˜ë“¤)
    const stations = [
      {
        name: 'ëª©ë™6ë‹¨ì§€ìƒê°€',
        lat: 37.536231,
        lon: 126.882298,
        audio: 'mok6Audio',
        displayText: 'ëª©ë™6ë‹¨ì§€ìƒê°€,ì´ëŒ€ë³‘ì›ì…êµ¬'
      },
      {
        name: 'ì„ ìœ ë„ì—­',
        lat: 37.539756,
        lon: 126.887565,
        audio: 'announcement',
        displayText: 'ì–‘í‰í•œì‹ ì•„íŒŒíŠ¸, 9í˜¸ì„ ì„ ìœ ë„ì—­'
      },
      {
        name: 'ë‹¹ì‚°ì—­',
        lat: 37.537096,
        lon: 126.900256,
        audio: 'dangsanAudio',
        displayText: 'ì§€í•˜ì²  2,9í˜¸ì„  ë‹¹ì‚°ì—­'
      }
    ];
    const targetRadius = 100; // 100ë¯¸í„° ë°˜ê²½
    
    // ë‘ ì§€ì  ê°„ì˜ ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (ë¯¸í„° ë‹¨ìœ„)
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371000; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }
    
    // GPS ìœ„ì¹˜ ì¶”ì 
    navigator.geolocation.watchPosition(pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      
      // ê°€ì¥ ê°€ê¹Œìš´ ì •ë¥˜ì†Œ ì°¾ê¸°
      let nearestStation = null;
      let minDistance = Infinity;
      
      stations.forEach(station => {
        const distance = calculateDistance(lat, lon, station.lat, station.lon);
        if (distance < minDistance) {
          minDistance = distance;
          nearestStation = station;
        }
      });
      
      locationDisplay.textContent = `ìœ„ì¹˜: ${lat.toFixed(6)}, ${lon.toFixed(6)} (ê°€ì¥ ê°€ê¹Œìš´ ì •ë¥˜ì†Œ: ${nearestStation.name} ${minDistance.toFixed(0)}m)`;
      
      // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ ì¶”ê°€
      console.log(`í˜„ì¬ ê±°ë¦¬: ${minDistance.toFixed(0)}m, ëª©í‘œ ë°˜ê²½: ${targetRadius}m, í˜„ì¬ ë””ìŠ¤í”Œë ˆì´: ${currentDisplay}, ê°€ì¥ ê°€ê¹Œìš´ ì •ë¥˜ì†Œ: ${nearestStation.name}`);
      
      // ëª©í‘œ ìœ„ì¹˜ 100m ì´ë‚´ì— ìˆê³ , í˜„ì¬ ì•ˆë‚´ ë¬¸êµ¬ ëª¨ë“œì¼ ë•Œ ìë™ìœ¼ë¡œ ì •ë¥˜ì†Œ ì•ˆë‚´ ì‹œì‘
      if (minDistance <= targetRadius && currentDisplay === 1) {
        console.log(`${nearestStation.name} ê·¼ì²˜ ë„ì°©! (ê±°ë¦¬: ${minDistance.toFixed(0)}m) ìë™ìœ¼ë¡œ ì •ë¥˜ì†Œ ì•ˆë‚´ ì‹œì‘`);
        startStationAnnouncement(nearestStation);
      }
      
      // 100m ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì•ˆë‚´ ë¬¸êµ¬ë¡œ ëŒì•„ê°€ê¸° (ë””ë²„ê¹…ìš©)
      if (minDistance > targetRadius && currentDisplay === 2) {
        console.log(`ì •ë¥˜ì†Œì—ì„œ ë©€ì–´ì§! (ê±°ë¦¬: ${minDistance.toFixed(0)}m) ì•ˆë‚´ ë¬¸êµ¬ë¡œ ëŒì•„ê°€ê¸°`);
        // ì£¼ì˜: ì´ ê¸°ëŠ¥ì€ í…ŒìŠ¤íŠ¸ìš©ì´ë¯€ë¡œ ì‹¤ì œ ì‚¬ìš© ì‹œì—ëŠ” ì£¼ì„ ì²˜ë¦¬í•˜ì„¸ìš”
        // switchToDisplay1();
      }
    }, err => {
      console.warn('GPS error:', err);
    }, { enableHighAccuracy: true });

    // í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ ìƒì„±
    const testBtnContainer = document.createElement('div');
    testBtnContainer.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px;';
    
    // ëª©ë™6ë‹¨ì§€ìƒê°€ í…ŒìŠ¤íŠ¸ ë²„íŠ¼
    const mok6TestBtn = document.createElement('button');
    mok6TestBtn.textContent = 'ğŸ”Š ëª©ë™6ë‹¨ì§€ìƒê°€ ì•ˆë‚´ ì‹œì‘';
    mok6TestBtn.style.cssText = 'padding: 15px 20px; background: #44aa44; color: white; border: 3px solid #228822; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.3);';
    mok6TestBtn.onclick = () => {
      console.log('ëª©ë™6ë‹¨ì§€ìƒê°€ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­');
      if (!userInteracted) {
        userInteracted = true;
        console.log('ëª©ë™6ë‹¨ì§€ìƒê°€ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ê°ì§€');
        const mok6Audio = document.getElementById('mok6Audio');
        if (mok6Audio) {
          mok6Audio.load();
        }
      }
      startStationAnnouncement(stations[0]);
    };
    
    // ì„ ìœ ë„ì—­ í…ŒìŠ¤íŠ¸ ë²„íŠ¼
    const seonyudoTestBtn = document.createElement('button');
    seonyudoTestBtn.textContent = 'ğŸ”Š ì„ ìœ ë„ì—­ ì•ˆë‚´ ì‹œì‘';
    seonyudoTestBtn.style.cssText = 'padding: 15px 20px; background: #ff4444; color: white; border: 3px solid #cc0000; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.3);';
    seonyudoTestBtn.onclick = () => {
      console.log('ì„ ìœ ë„ì—­ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­');
      if (!userInteracted) {
        userInteracted = true;
        console.log('ì„ ìœ ë„ì—­ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ê°ì§€');
        const audio = document.getElementById('announcement');
        if (audio) {
          audio.load();
        }
      }
      startStationAnnouncement(stations[1]);
    };
    
    // ë‹¹ì‚°ì—­ í…ŒìŠ¤íŠ¸ ë²„íŠ¼
    const dangsanTestBtn = document.createElement('button');
    dangsanTestBtn.textContent = 'ğŸ”Š ë‹¹ì‚°ì—­ ì•ˆë‚´ ì‹œì‘';
    dangsanTestBtn.style.cssText = 'padding: 15px 20px; background: #4444ff; color: white; border: 3px solid #0000cc; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.3);';
    dangsanTestBtn.onclick = () => {
      console.log('ë‹¹ì‚°ì—­ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­');
      if (!userInteracted) {
        userInteracted = true;
        console.log('ë‹¹ì‚°ì—­ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ê°ì§€');
        const dangsanAudio = document.getElementById('dangsanAudio');
        if (dangsanAudio) {
          dangsanAudio.load();
        }
      }
      startStationAnnouncement(stations[2]);
    };
    
    testBtnContainer.appendChild(mok6TestBtn);
    testBtnContainer.appendChild(seonyudoTestBtn);
    testBtnContainer.appendChild(dangsanTestBtn);
    document.body.appendChild(testBtnContainer);
    
    // ì¶”ê°€ë¡œ ì˜¤ë””ì˜¤ í™œì„±í™” ë²„íŠ¼ë„ í‘œì‹œ
    const audioBtn = document.createElement('button');
    audioBtn.id = 'audioBtn';
    audioBtn.textContent = 'ğŸ”Š ì˜¤ë””ì˜¤ í™œì„±í™”';
    audioBtn.style.cssText = 'position: fixed; top: 80px; right: 20px; z-index: 1000; padding: 10px 15px; background: #44aa44; color: white; border: 2px solid #228822; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold;';
    audioBtn.onclick = () => {
      if (!userInteracted) {
        userInteracted = true;
        console.log('ì˜¤ë””ì˜¤ í™œì„±í™” ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ê°ì§€');
        if (audio) {
          audio.load();
        }
        audioBtn.textContent = 'âœ… ì˜¤ë””ì˜¤ í™œì„±í™”ë¨';
        audioBtn.style.background = '#228822';
        setTimeout(() => {
          audioBtn.style.display = 'none';
        }, 2000);
      }
    };
    document.body.appendChild(audioBtn);

    // ê²©ì ìƒì„±
    const gridOverlay = document.getElementById('grid-overlay');
    for (let i = 0; i < 128 * 32; i++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      gridOverlay.appendChild(cell);
    }

    // ì´ˆê¸° ë””ìŠ¤í”Œë ˆì´ ì‹œì‘
    switchToDisplay1();
  </script>
</body>
</html> 
